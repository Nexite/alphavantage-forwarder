generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Symbol {
  id              String            @id // e.g., "AAPL"
  dailyQuotes     DailyQuote[]
  dailyOptions    DailyOptionsChain[]
  dailyContracts  DailyOptionContract[]
}

model DailyQuote {
  id          String      @id // format: "{symbolId}-{date}"
  symbol      Symbol      @relation(fields: [symbolId], references: [id])
  symbolId    String
  price       Decimal
  date        DateTime    @db.Date
  
  @@unique([symbolId, date])
  @@index([date])
  @@index([symbolId, date])
}

model DailyOptionsChain {
  // id              String                 @id // format: "{symbolId}-{date}"
  symbol          Symbol                 @relation(fields: [symbolId], references: [id])
  symbolId        String
  date            DateTime             @db.Date
  contracts       DailyOptionContract[]

  @@unique([symbolId, date])
  @@id([symbolId, date])
  @@index([date])
}

model DailyOptionContract {
  // id                 String             @id // format: "{contractID}-{date}"
  contractId         String
  date               DateTime          @db.Date
  symbol            Symbol             @relation(fields: [symbolId], references: [id])
  symbolId          String             
  chain             DailyOptionsChain  @relation(fields: [symbolId, date], references: [symbolId, date])
  expiration        DateTime          @db.Date
  strike            Decimal
  type              OptionType
  // last              Decimal?
  // mark              Decimal?
  bid               Decimal?
  // bidSize           Int?
  ask               Decimal?
  // askSize           Int?
  // volume            Int?
  // openInterest      Int?
  // impliedVolatility Decimal?
  delta             Decimal?
  gamma             Decimal?
  theta             Decimal?
  vega              Decimal?
  rho               Decimal?

  @@id([contractId, date])
  @@index([symbolId, expiration])
  @@index([symbolId, date, type, expiration])
}

enum OptionType {
  CALL
  PUT
}


model Holiday {
  id          String      @id // format: "{yyyy}-{MM}-{dd}"
  date        DateTime    @db.Date
  type        HolidayType
}

enum HolidayType {
  CLOSED
  EARLY_CLOSE
}